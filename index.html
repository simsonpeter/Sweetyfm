<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Sweety FM - Listen Live</title>
  <meta name="description" content="Sweety FM - Your premier destination for Tamil, Telugu, Malayalam, and Iniyan music">
  <link rel="manifest" href="/manifest.webmanifest">
  <style>
    :root {
      --primary-color: #ffa500;
      --bg-opacity: 0.14;
      --text-color: #333;
      --bg-color: rgba(255, 255, 255, var(--bg-opacity));
      --section-bg: rgba(255, 255, 255, 0.9);
    }

    body.dark-mode {
      --bg-opacity: 0.7;
      --text-color: #fff;
      --bg-color: rgba(0, 0, 0, var(--bg-opacity));
      --section-bg: rgba(0, 0, 0, 0.9);
    }

    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-image: url('https://i.ibb.co/PZH0Z05Y/microphone-acoustic-isolation-foam.webp');
      background-size: cover;
      background-position: center;
      background-blend-mode: overlay;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Header Styles */
    .title-bar {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 1rem;
      background: var(--primary-color);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    /* Main Content */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4rem 1rem 6rem;
      width: 100%;
    }

    /* Verse Display */
    .verse-container {
      background: var(--section-bg);
      padding: 1.5rem;
      border-radius: 1rem;
      margin: 1rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      max-width: 800px;
      text-align: center;
    }

    /* Play Controls */
    .play-controls {
      position: relative;
      margin: 2rem 0;
    }

    .play-button {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .play-button:hover {
      transform: scale(1.05);
    }

    .play-button i {
      color: white;
      font-size: 3rem;
      margin-left: 5px;
    }

    /* Tabs Navigation */
    .tabs {
      position: fixed;
      bottom: 0;
      width: 100%;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      background: var(--section-bg);
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }

    .tab {
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tab.active,
    .tab:hover {
      background: var(--primary-color);
      color: white;
    }

    /* About Section */
    .about-us {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--section-bg);
      padding: 2rem;
      border-radius: 1rem;
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1001;
      display: none;
    }

    /* Error Messages */
    .error-message {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: #ff4444;
      color: white;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { bottom: -4rem; }
      to { bottom: 1rem; }
    }

    /* Loading Spinner */
    .loading-spinner {
      width: 24px;
      height: 24px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: none;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .verse-container {
        padding: 1rem;
        margin: 1rem 0.5rem;
      }

      .play-button {
        width: 80px;
        height: 80px;
      }

      .play-button i {
        font-size: 2rem;
      }

      .tabs {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <header class="title-bar">
    <h1>Sweety FM</h1>
    <div class="controls">
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>
      <button class="about-toggle" id="about-toggle" aria-label="About">
        <i class="fas fa-info-circle"></i>
      </button>
    </div>
  </header>

  <main>
    <section class="verse-container" aria-live="polite">
      <h2 id="verse-text">Loading verse...</h2>
      <p id="verse-translation"></p>
      <div class="loading-spinner" id="verse-loader"></div>
    </section>

    <div class="play-controls">
      <div class="play-button" id="play-button" role="button" aria-label="Play/pause">
        <i class="fas fa-play"></i>
      </div>
      <div class="loading-spinner" id="audio-loader"></div>
    </div>
  </main>

  <footer class="tabs" role="tablist">
    <button class="tab active" role="tab" aria-selected="true" data-stream="https://stream.sweetyfm.com/tamil">Tamil</button>
    <button class="tab" role="tab" data-stream="https://stream.sweetyfm.com/telugu">Telugu</button>
    <button class="tab" role="tab" data-stream="https://stream.sweetyfm.com/malayalam">Malayalam</button>
    <button class="tab" role="tab" data-stream="https://stream.sweetyfm.com/iniyan">Iniyan</button>
  </footer>

  <dialog class="about-us" id="about-dialog">
    <h2>About Sweety FM</h2>
    <!-- About content here -->
    <button onclick="document.getElementById('about-dialog').close()" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </dialog>

  <audio id="audio-player" preload="none">
    <source src="https://stream.sweetyfm.com/tamil" type="audio/mpeg">
  </audio>

  <script>
    // Theme Management
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    let isDarkMode = localStorage.getItem('theme') === 'dark' || 
      (window.matchMedia('(prefers-color-scheme: dark)').matches && !('theme' in localStorage));

    function updateTheme() {
      body.classList.toggle('dark-mode', isDarkMode);
      themeToggle.innerHTML = isDarkMode ? 
        '<i class="fas fa-sun"></i>' : 
        '<i class="fas fa-moon"></i>';
      localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    }
    updateTheme();

    themeToggle.addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      updateTheme();
    });

    // Audio Management
    const audio = document.getElementById('audio-player');
    const playButton = document.getElementById('play-button');
    const tabs = document.querySelectorAll('.tab');
    let currentStream = '';

    async function loadStream(streamUrl) {
      if (currentStream === streamUrl) return;
      
      showLoader('audio-loader');
      try {
        audio.src = streamUrl;
        await audio.play();
        currentStream = streamUrl;
        playButton.querySelector('i').classList.replace('fa-play', 'fa-pause');
      } catch (error) {
        showError('Error connecting to stream. Please try again.');
      } finally {
        hideLoader('audio-loader');
      }
    }

    // UI Controls
    playButton.addEventListener('click', () => {
      audio.paused ? audio.play() : audio.pause();
    });

    audio.addEventListener('play', () => {
      playButton.querySelector('i').classList.replace('fa-play', 'fa-pause');
    });

    audio.addEventListener('pause', () => {
      playButton.querySelector('i').classList.replace('fa-pause', 'fa-play');
    });

    // Tab Navigation
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
        });
        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');
        loadStream(tab.dataset.stream);
      });
    });

    // Error Handling
    audio.addEventListener('error', () => {
      showError('Stream connection error. Trying again...');
      setTimeout(() => loadStream(currentStream), 5000);
    });

    function showError(message) {
      const errorEl = document.createElement('div');
      errorEl.className = 'error-message';
      errorEl.textContent = message;
      document.body.appendChild(errorEl);
      setTimeout(() => errorEl.remove(), 5000);
    }

    // Loaders
    function showLoader(id) {
      document.getElementById(id).style.display = 'block';
    }

    function hideLoader(id) {
      document.getElementById(id).style.display = 'none';
    }

    // Verse Loading
    async function loadVerse() {
      showLoader('verse-loader');
      try {
        const response = await fetch('verses.json');
        const verses = await response.json();
        const { text, translation } = verses[Math.floor(Math.random() * verses.length)];
        document.getElementById('verse-text').textContent = text;
        document.getElementById('verse-translation').textContent = translation;
      } catch {
        showError('Error loading daily verse');
      } finally {
        hideLoader('verse-loader');
      }
    }

    // About Dialog
    document.getElementById('about-toggle').addEventListener('click', () => {
      document.getElementById('about-dialog').showModal();
    });

    // Initialize
    loadVerse();
    loadStream(document.querySelector('.tab.active').dataset.stream);

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .catch(error => console.log('SW registration failed:', error));
      });
    }

    // Keyboard Navigation
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        playButton.click();
      }
    });
  </script>
</body>
</html>
